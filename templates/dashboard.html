<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayslipSnap ‚Äî Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;background:#f0f4f8;min-height:100vh}.topbar{background:#141926;border-bottom:1px solid #2A3148;padding:14px 24px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}.topbar h1{font-size:20px;font-weight:700;color:#E8ECF4}.topbar h1 span{color:#7c3aed}.topbar-right{display:flex;align-items:center;gap:10px}.topbar-right a{font-size:13px;color:#8B95B0;text-decoration:none;padding:8px 14px;border-radius:8px;transition:all .2s}.topbar-right a:hover{background:#2A3148;color:#E8ECF4}.topbar-right a.primary{background:#7c3aed;color:#fff;font-weight:600}.topbar-right a.primary:hover{background:#6d28d9}.main{max-width:1100px;margin:0 auto;padding:24px}.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:24px}.stat-card{background:#141926;border-radius:12px;padding:20px;font-weight:600;color:#8B95B0;text-transform:uppercase;letter-spacing:.5px}.stat-card .value{font-size:28px;font-weight:700;color:#E8ECF4;margin-top:4px}.stat-card .sub{font-size:13px;color:#94a3b8;margin-top:2px}.stat-card.emp{border-left:4px solid #7c3aed}.stat-card.payout{border-left:4px solid #22c55e}.stat-card.tds{border-left:4px solid #f59e0b}.stat-card.pf{border-left:4px solid #2563eb}.card{background:#141926;border-radius:12px;padding:24px;margin-bottom:20px}.card h3{font-size:16px;font-weight:700;color:#E8ECF4;margin-bottom:16px}table{width:100%;border-collapse:collapse}th{padding:10px 14px;text-align:left;font-size:12px;font-weight:600;color:#8B95B0;text-transform:uppercase;background:#0B0F1A;border-bottom:1px solid #2A3148}td{padding:12px 14px;font-size:14px;color:#374151;border-bottom:1px solid #f1f5f9}tr:hover{background:#0B0F1A}.status{display:inline-block;padding:4px 10px;border-radius:20px;font-size:12px;font-weight:600}.status.generated{background:#dcfce7;color:#16a34a}.status.draft{background:#2A3148;color:#8B95B0}.actions a{color:#7c3aed;text-decoration:none;font-weight:500;font-size:13px}.actions a:hover{text-decoration:underline}.empty{text-align:center;padding:48px 20px}.empty h3{font-size:18px;color:#374151;margin-bottom:8px}.empty p{color:#94a3b8;font-size:14px;margin-bottom:16px}.empty a{display:inline-block;padding:10px 20px;background:#7c3aed;color:#fff;border-radius:8px;text-decoration:none;font-weight:600;font-size:14px}.flash{padding:12px 16px;border-radius:10px;font-size:14px;margin-bottom:16px}.flash.success{background:#f0fdf4;color:#16a34a;border:1px solid #bbf7d0}.flash.error{background:#fef2f2;color:#dc2626;border:1px solid #fecaca}
    </style>
</head>
<body>
<div class="topbar">
    <h1>Payslip<span>Snap</span></h1>
    <div class="topbar-right">
        <a href="https://snapsuite.up.railway.app" target="_blank" style="font-size:12px;color:#8B95B0;padding:6px 12px;border:1px solid #2A3148;border-radius:6px;font-weight:600">‚Üê SnapSuite</a>
        <a href="/generate" class="primary">üìã Generate Payslips</a>
        <a href="/employees">üë• Employees</a>
        <a href="/payslips">üìÑ Payslips</a>
        <a href="/yearend">üìä Year-End</a>
        {% if user.is_superadmin %}<a href="/admin">üëë Admin</a>{% endif %}
        <a href="/settings">‚öôÔ∏è</a>
        <a href="/logout">Sign out</a>
    </div>
</div>
<div class="main">
    {% with messages = get_flashed_messages(with_categories=true) %}{% for cat, msg in messages %}<div class="flash {{ cat }}">{{ msg }}</div>{% endfor %}{% endwith %}

    <div class="stats">
        <div class="stat-card emp">
            <div class="label">Active Employees</div>
            <div class="value">{{ emp_stats.active }}</div>
            <div class="sub">{{ emp_stats.total }} total</div>
        </div>
        <div class="stat-card payout">
            <div class="label">{{ now.strftime('%B') }} Payout</div>
            <div class="value">Rs.{{ "{:,.0f}".format(payroll.total_payout) }}</div>
            <div class="sub">{{ payroll.generated }} payslips</div>
        </div>
        <div class="stat-card tds">
            <div class="label">{{ now.strftime('%B') }} TDS</div>
            <div class="value">Rs.{{ "{:,.0f}".format(payroll.total_tds) }}</div>
        </div>
        <div class="stat-card pf">
            <div class="label">{{ now.strftime('%B') }} PF</div>
            <div class="value">Rs.{{ "{:,.0f}".format(payroll.total_pf) }}</div>
        </div>
    </div>

    <div class="card">
        <h3>Recent Payslips</h3>
        {% if recent %}
        <table>
            <thead><tr><th>Employee</th><th>Period</th><th>Gross</th><th>Deductions</th><th>Net Pay</th><th>Status</th><th>Actions</th></tr></thead>
            <tbody>
            {% for s in recent %}
            <tr>
                <td><strong>{{ s.emp_name }}</strong><br><span style="font-size:12px;color:#94a3b8">{{ s.emp_code }} ¬∑ {{ s.designation }}</span></td>
                <td>{{ ['','Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][s.month] }} {{ s.year }}</td>
                <td>Rs.{{ "{:,.0f}".format(s.gross_earnings) }}</td>
                <td>Rs.{{ "{:,.0f}".format(s.total_deductions) }}</td>
                <td><strong>Rs.{{ "{:,.0f}".format(s.net_pay) }}</strong></td>
                <td><span class="status {{ s.status }}">{{ s.status | capitalize }}</span></td>
                <td class="actions"><a href="/payslip/{{ s.id }}">View</a> ¬∑ <a href="/payslip/{{ s.id }}/pdf">PDF</a></td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty">
            <h3>No payslips yet</h3>
            <p>Add employees first, then generate monthly payslips.</p>
            <a href="/employees">üë• Add Employees</a>
        </div>
        {% endif %}
    </div>
</div>
</body></html>
