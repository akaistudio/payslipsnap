<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayslipSnap ‚Äî {{ slip.emp_name }} - {{ month_name }} {{ slip.year }}</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:'DM Sans',sans-serif;background:#f0f4f8;min-height:100vh}.topbar{background:#141926;border-bottom:1px solid #2A3148;padding:14px 24px;display:flex;align-items:center;justify-content:space-between}.topbar h1{font-size:20px;font-weight:700;color:#E8ECF4}.topbar h1 span{color:#7c3aed}.topbar-right{display:flex;gap:8px}.topbar-right a{font-size:13px;color:#8B95B0;text-decoration:none;padding:8px 14px;border-radius:8px}.topbar-right a.primary{background:#7c3aed;color:#fff;font-weight:600}.main{max-width:800px;margin:0 auto;padding:24px}.payslip-card{background:#141926;border-radius:12px;padding:32px;justify-content:space-between;margin-bottom:24px}.company-name{font-size:20px;font-weight:700;color:{{ user.brand_color or '#7c3aed' }}}.period{text-align:right;font-size:14px;color:#8B95B0}.period strong{font-size:16px;color:#E8ECF4;display:block}.info-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:24px;padding:16px;background:#0B0F1A;border-radius:10px}.info-item{font-size:13px}.info-item .label{color:#8B95B0;font-weight:500}.info-item .value{color:#E8ECF4;font-weight:600}.earn-ded{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:24px}.section h4{font-size:13px;font-weight:700;color:#7c3aed;text-transform:uppercase;letter-spacing:.5px;margin-bottom:10px;padding-bottom:6px;border-bottom:2px solid #e9d5ff}.line{display:flex;justify-content:space-between;padding:6px 0;font-size:14px}.line .label{color:#8B95B0}.line .value{font-weight:600;color:#E8ECF4}.line.total{border-top:1px solid #2A3148;padding-top:10px;margin-top:6px}.line.total .label{font-weight:700;color:#374151}.line.total .value{color:#7c3aed}.net-pay{background:#f0fdf4;border:2px solid #22c55e;border-radius:12px;padding:20px;text-align:center;margin-bottom:20px}.net-pay .label{font-size:14px;color:#16a34a;font-weight:600;text-transform:uppercase}.net-pay .amount{font-size:32px;font-weight:700;color:#15803d;margin-top:4px}.employer-contrib{background:#0B0F1A;border-radius:8px;padding:12px 16px;font-size:13px;color:#8B95B0}.employer-contrib strong{color:#374151}.flash{padding:12px 16px;border-radius:10px;font-size:14px;margin-bottom:16px}.flash.error{background:#fef2f2;color:#dc2626;border:1px solid #fecaca}
    </style>
</head>
<body>
<div class="topbar">
    <a href="/login" style="text-decoration:none;color:inherit"><h1>Payslip<span>Snap</span></h1></a>
    <div class="topbar-right"><a href="https://snapsuite.up.railway.app" target="_blank" style="font-size:12px;color:#8B95B0;text-decoration:none;padding:6px 12px;border:1px solid #2A3148;border-radius:6px;font-weight:600">‚Üê SnapSuite</a><div style="position:relative;display:inline-block"><button onclick="this.nextElementSibling.style.display=this.nextElementSibling.style.display==='block'?'none':'block'" style="font-size:14px;background:none;border:1px solid #2A3148;border-radius:6px;padding:5px 10px;color:#8B95B0;cursor:pointer" title="Switch App">‚äû</button><div style="display:none;position:absolute;right:0;top:32px;background:#141926;border:1px solid #2A3148;border-radius:10px;padding:8px;min-width:180px;z-index:200;box-shadow:0 8px 30px rgba(0,0,0,.5)"><a href="https://invoicesnap.up.railway.app" style="display:block;padding:8px 12px;color:#E8ECF4;text-decoration:none;border-radius:6px;font-size:13px;font-weight:500" onmouseover="this.style.background='#2A3148'" onmouseout="this.style.background='none'">üìÑ InvoiceSnap</a><a href="https://expensesnap.up.railway.app" style="display:block;padding:8px 12px;color:#E8ECF4;text-decoration:none;border-radius:6px;font-size:13px;font-weight:500" onmouseover="this.style.background='#2A3148'" onmouseout="this.style.background='none'">üì∏ ExpenseSnap</a><a href="https://contractsnap-app.up.railway.app" style="display:block;padding:8px 12px;color:#E8ECF4;text-decoration:none;border-radius:6px;font-size:13px;font-weight:500" onmouseover="this.style.background='#2A3148'" onmouseout="this.style.background='none'">üìã ContractSnap</a><a href="https://proposalsnap.up.railway.app" style="display:block;padding:8px 12px;color:#E8ECF4;text-decoration:none;border-radius:6px;font-size:13px;font-weight:500" onmouseover="this.style.background='#2A3148'" onmouseout="this.style.background='none'">üéØ ProposalSnap</a></div></div>
        <a href="/payslips?month={{ slip.month }}&year={{ slip.year }}">‚Üê Back</a>
        <a href="/payslip/{{ slip.id }}/pdf" class="primary">‚¨á Download PDF</a>
    </div>
</div>
<div class="main">
    {% with messages = get_flashed_messages(with_categories=true) %}{% for cat, msg in messages %}<div class="flash {{ cat }}">{{ msg }}</div>{% endfor %}{% endwith %}

    <div class="payslip-card">
        <div class="company-row">
            <div>
                {% if user.logo_data %}<img src="{{ user.logo_data }}" style="max-height:40px;margin-bottom:6px"><br>{% endif %}
                <span class="company-name">{{ user.company_name or 'Company' }}</span>
                {% if user.company_address %}<div style="font-size:12px;color:#94a3b8">{{ user.company_address }}</div>{% endif %}
            </div>
            <div class="period">
                <strong>{{ month_name }} {{ slip.year }}</strong>
                Payslip
            </div>
        </div>

        <div class="info-grid">
            <div class="info-item"><span class="label">Employee: </span><span class="value">{{ slip.emp_name }}</span></div>
            <div class="info-item"><span class="label">Code: </span><span class="value">{{ slip.emp_code or '-' }}</span></div>
            <div class="info-item"><span class="label">Department: </span><span class="value">{{ slip.department or '-' }}</span></div>
            <div class="info-item"><span class="label">Designation: </span><span class="value">{{ slip.designation or '-' }}</span></div>
            <div class="info-item"><span class="label">PAN: </span><span class="value">{{ slip.emp_pan or '-' }}</span></div>
            <div class="info-item"><span class="label">UAN: </span><span class="value">{{ slip.uan_number or '-' }}</span></div>
            <div class="info-item"><span class="label">Bank: </span><span class="value">{{ slip.bank_name or '-' }} {{ slip.bank_account or '' }}</span></div>
            <div class="info-item"><span class="label">Days Worked: </span><span class="value">{{ slip.days_worked }} / {{ slip.days_in_month }} {% if slip.lop_days > 0 %}({{ slip.lop_days }} LOP){% endif %}</span></div>
        </div>

        <div class="earn-ded">
            <div class="section">
                <h4>Earnings</h4>
                {% if slip.payroll_country in ['CA', 'US', 'UK', 'EU', 'MY'] %}
                {% set curr_map = {'CA':'C$','US':'$','UK':'¬£','EU':'‚Ç¨','MY':'RM'} %}
                {% set curr = curr_map.get(slip.payroll_country, '$') %}
                <div class="line"><span class="label">Gross Salary</span><span class="value">{{ curr }}{{ "{:,.2f}".format(slip.basic) }}</span></div>
                {% else %}
                {% set curr = 'Rs.' %}
                <div class="line"><span class="label">Basic</span><span class="value">Rs.{{ "{:,.2f}".format(slip.basic) }}</span></div>
                <div class="line"><span class="label">HRA</span><span class="value">Rs.{{ "{:,.2f}".format(slip.hra) }}</span></div>
                {% if slip.da > 0 %}<div class="line"><span class="label">DA</span><span class="value">Rs.{{ "{:,.2f}".format(slip.da) }}</span></div>{% endif %}
                <div class="line"><span class="label">Special Allowance</span><span class="value">Rs.{{ "{:,.2f}".format(slip.special_allowance) }}</span></div>
                {% endif %}
                {% if slip.other_earnings > 0 %}<div class="line"><span class="label">Other Earnings</span><span class="value">{{ curr }}{{ "{:,.2f}".format(slip.other_earnings) }}</span></div>{% endif %}
                <div class="line total"><span class="label">Gross Earnings</span><span class="value">{{ curr }}{{ "{:,.2f}".format(slip.gross_earnings) }}</span></div>
            </div>
            <div class="section">
                <h4>Deductions</h4>
                {% if slip.payroll_country in ['US', 'UK', 'EU', 'MY'] %}
                {% if slip.pf_employee > 0 %}<div class="line"><span class="label">{{ slip.custom_tax1_label or 'Tax 1' }} ({{ slip.custom_tax1_rate or 0 }}%)</span><span class="value">{{ curr }}{{ "{:,.2f}".format(slip.pf_employee) }}</span></div>{% endif %}
                {% if slip.esi_employee > 0 %}<div class="line"><span class="label">{{ slip.custom_tax2_label or 'Tax 2' }} ({{ slip.custom_tax2_rate or 0 }}%)</span><span class="value">{{ curr }}{{ "{:,.2f}".format(slip.esi_employee) }}</span></div>{% endif %}
                {% if slip.professional_tax > 0 %}<div class="line"><span class="label">{{ slip.custom_tax3_label or 'Tax 3' }} ({{ slip.custom_tax3_rate or 0 }}%)</span><span class="value">{{ curr }}{{ "{:,.2f}".format(slip.professional_tax) }}</span></div>{% endif %}
                {% if slip.tds > 0 %}<div class="line"><span class="label">{{ slip.custom_tax4_label or 'Tax 4' }} ({{ slip.custom_tax4_rate or 0 }}%)</span><span class="value">{{ curr }}{{ "{:,.2f}".format(slip.tds) }}</span></div>{% endif %}
                {% elif slip.payroll_country == 'CA' %}
                {% if slip.pf_employee > 0 %}<div class="line"><span class="label">CPP (Employee)</span><span class="value">C${{ "{:,.2f}".format(slip.pf_employee) }}</span></div>{% endif %}
                {% if slip.esi_employee > 0 %}<div class="line"><span class="label">EI (Employee)</span><span class="value">C${{ "{:,.2f}".format(slip.esi_employee) }}</span></div>{% endif %}
                {% if slip.professional_tax > 0 %}<div class="line"><span class="label">Provincial Tax</span><span class="value">C${{ "{:,.2f}".format(slip.professional_tax) }}</span></div>{% endif %}
                {% if slip.tds > 0 %}<div class="line"><span class="label">Federal Tax</span><span class="value">C${{ "{:,.2f}".format(slip.tds) }}</span></div>{% endif %}
                {% else %}
                {% if slip.pf_employee > 0 %}<div class="line"><span class="label">PF (Employee)</span><span class="value">Rs.{{ "{:,.2f}".format(slip.pf_employee) }}</span></div>{% endif %}
                {% if slip.esi_employee > 0 %}<div class="line"><span class="label">ESI (Employee)</span><span class="value">Rs.{{ "{:,.2f}".format(slip.esi_employee) }}</span></div>{% endif %}
                {% if slip.professional_tax > 0 %}<div class="line"><span class="label">Professional Tax</span><span class="value">Rs.{{ "{:,.2f}".format(slip.professional_tax) }}</span></div>{% endif %}
                {% if slip.tds > 0 %}<div class="line"><span class="label">TDS / Income Tax</span><span class="value">Rs.{{ "{:,.2f}".format(slip.tds) }}</span></div>{% endif %}
                {% endif %}
                {% if slip.other_deductions > 0 %}<div class="line"><span class="label">Other Deductions</span><span class="value">{{ curr }}{{ "{:,.2f}".format(slip.other_deductions) }}</span></div>{% endif %}
                <div class="line total"><span class="label">Total Deductions</span><span class="value">{{ curr }}{{ "{:,.2f}".format(slip.total_deductions) }}</span></div>
            </div>
        </div>

        <div class="net-pay">
            <div class="label">Net Pay</div>
            <div class="amount">{{ curr }}{{ "{:,.2f}".format(slip.net_pay) }}</div>
        </div>

        {% if slip.payroll_country not in ['US', 'UK', 'EU', 'MY'] %}
        <div class="employer-contrib">
            <strong>Employer Contributions</strong> (not deducted from salary):
            {% if slip.payroll_country == 'CA' %}
            CPP: C${{ "{:,.2f}".format(slip.pf_employer) }}
            {% if slip.esi_employer > 0 %} | EI: C${{ "{:,.2f}".format(slip.esi_employer) }}{% endif %}
            {% else %}
            PF: Rs.{{ "{:,.2f}".format(slip.pf_employer) }}
            {% if slip.esi_employer > 0 %} | ESI: Rs.{{ "{:,.2f}".format(slip.esi_employer) }}{% endif %}
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
</body></html>
